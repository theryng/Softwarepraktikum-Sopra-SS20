<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link th:href="@{/css/style.css}" rel="stylesheet" />

    <title>Kontakte</title>
</head>

<body>

<!--Navbar fragment on top of the site. Contains all navigation elements of the project as well as the dropdown menu in order to view the options, logout or add User button-->
<header th:insert="fragments/htmlHead.html :: header"> </header>

<div class="container-fluid mt-5">

    <!-- Main Body of the ContactDetails Site, includes general Information, aswell as Contact Histories and Relationships, which all can be Edited or removed-->
    <h1 class="ml-1"> Institut Informationen</h1>
    <div class="row ml-1">
        <form ACTION="#" th:action="@{/backInstituteDetails}" method="post">
            <button type="submit" class="btn btn-secondary">Zurück</button>
        </form>

        <!-- Button trigger modal -->
        <button type="button" class="btn btn-danger ml-1" data-toggle="modal" data-target="#deleteModal">
            Kontakt Löschen
        </button>

        <!-- Modal -->
        <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="deleteModalLabel">Beziehung Löschen</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        Sind sie sicher das Sie dieses Institut löschen möchten?

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Abbrechen</button>
                        <form ACTION="#" th:action="@{/deleteInstitute}" th:object="${institute}" method="post">
                            <input type="hidden" th:value="${institute.instituteID}" th:name ="instituteID" />

                            <button type="submit" class="btn btn-danger ml-3">Institut löschen</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Accordion for better navigation-->
    <div class="accordion mt-2" id="accordionExample">
        <div class="card">

            <!-- First Accordion Element, with general Information of the viewed Contact-->
            <div class="card-header" id="headingOne">
                <h1 class="mb-0">
                    <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                        <h3>Allgemeine Kontaktinformationen</h3>
                    </button>
                </h1>
            </div>

            <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordionExample">
                <div class="card-body">
                    <form class="form-horizontal" id="multiCollapseExample1" th:object="${institute}" th:action="@{/savingInstitute}" method="post">
                        <!-- Input and View Field for the Contact Details-->
                        <div class="alert alert-danger" role="alert" th:if="${hasError}">
                            Bitte überprüfen Sie Ihre Änderungen, da diese Fehlerhaft sind.
                        </div>
                        <!--Inputs for a contact in a small Modal once the button: Neuen Kontakt hinzufügen is pushed-->
                        <div>
                            Name: <input type="text" class="form-control" name = "name"
                                         pattern="[0-9?!¡¿“¶[]|{}≠€§$%&/()=`+#'.,{´]^°<>]"
                                         th:field="*{name}" required>
                            <div class="valid-feedback">valid</div>
                            <div class="invalid-feedback">Bitte geben sie einen Namen an</div>

                            Homepage:<input type="text" class="form-control" name = "linkToHomepage" th:field="*{linkToHomepage}" required/></br>

                            E-Mail:<input type="email" class="form-control" name = "linkToHomepage" th:field="*{email}" required/></br>
                            <div class = "row">
                                <div class = "col">
                                    Stadt:<input type="text" class="form-control" name = "tempCity" minlength="3" th:field="*{address.city}" required/>

                                </div>
                                <div class = "col">
                                    Straße:<input type="text" class="form-control" name = "tempStreet" minlength="3" th:field="*{address.street}" required/>
                                </div>
                                <div class = "col">
                                    Hausnummer:<input type="text" class="form-control" name = "tempHouseNmbr" th:field="*{address.houseNumber}" required/>
                                </div>
                                <div class = "col">
                                    Postleitzahl:<input type="text" class="form-control" name = "tempZipCode" th:field="*{address.zipCode}"
                                                        pattern="^[0-9]{5}$" title="Postleitzahlen bestehen nur aus Zahlen und sind 5 Zeichen lang" required/>
                                </div>
                            </div>
                        </div>

                        <!-- Button trigger modal -->
                        <button type="button" class="btn btn-primary mt-3" data-toggle="modal" data-target="#saveModal">
                            Änderungen speichern
                        </button>

                        <!-- Modal -->
                        <div class="modal fade" id="saveModal" tabindex="-1" role="dialog" aria-labelledby="saveModalLabel" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="saveModalLabel">Institut bearbeiten</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        Sind sie sicher das Sie die Änderungen speichern möchten?
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Abbrechen</button>
                                        <button type="submit" class="btn btn-primary">Änderungen speichern</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </form>

                </div>
            </div>
        </div>
        <!-- Second Accordion Element for Relationships-->
        <div class="card">
            <div class="card-header" id="headingTwo">
                <h2 class="mb-0">
                    <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                        <h3>Mitarbeiter</h3>
                    </button>
                </h2>
            </div>
            <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionExample">
                <div class="card-body">
                    <!--Table for Relationships-->
                    <table class="table table-striped" th:if="${existingContacts}">
                        <tr>
                            <th>Name</th>
                            <th>Studium</th>
                            <th>Homepage</th>
                            <th>Funktionen</th>
                        </tr>
                        <tr th:each="contact : ${institute.contacts}">
                            <td th:text="${contact.firstname + ' ' + contact.lastname}"></td>
                            <td th:text="${contact.courseOfStudies}"></td>
                            <td th:text="${contact.linkToHomepage}"></td>
                            <td>
                                <form ACTION="#" th:action="@{/deleteContactFromInstitute}" th:object="${tempContact}" method="post">
                                    <input type="hidden" th:value="${contact.contactID}" th:name ="contactID" />
                                    <button type="submit" class="btn btn-danger">Mitarbeiter entfernen </button>
                                </form>
                            </td>
                        </tr>
                    </table>
                    <!-- If Statement if no Relationship is available -->
                    <div th:if="${not existingContacts}" class="ml-5 mr-5 mt-5">
                        Institut besitzt keine Mitarbeiter, neuen Mitarbeiter zuordnen?
                    </div>
                    <!-- Button to Start Creation of new Relationship -->
                    <form class="ml-5 mr-5 mt-5" ACTION="#" th:action="@{/addContactsToInstitute}" th:object="${institutes}" method="post">
                        <input type="hidden" th:value="${institute.instituteID}" th:name ="instituteID" />
                        <button type="submit" class="btn btn-secondary"> Mitarbeiter zuordnen </button>
                    </form>


                </div>
            </div>
        </div>
    </div>
</div>



<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
</body>
</html>