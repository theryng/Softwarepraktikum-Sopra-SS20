<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html" xmlns:sec="">
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link th:href="@{/css/style.css}" rel="stylesheet" />

    <script src="https://kit.fontawesome.com/432f23bc6a.js" crossorigin="anonymous"></script>

    <title>User Details</title>
</head>
<body class="backgroundimage">

<!--Navbar fragment on top of the site. Contains all navigation elements of the project as well as the dropdown menu in order to view the options, logout or add User button-->
<header th:insert="fragments/htmlHead.html :: header"> </header>

<div class="container-fluid mt-5">

    <!-- Main Body of the ContactDetails Site, includes general Information, aswell as Contact Histories and Relationships, which all can be Edited or removed-->
    <h1 class="ml-1"> Kontaktinformationen</h1>
    <div class="row ml-1">
        <form ACTION="#" th:action="@{/backUserDetails}" method="post">
            <button type="submit" class="btn btn-secondary">Zurück</button>
        </form>
    </div>

    <!-- Accordion for better navigation-->
    <div class="accordion mt-2" id="accordionExample">
        <div class="card">

            <!-- First Accordion Element, with general Information of the viewed Contact-->
            <div class="card-header" id="headingOne">
                <h1 class="mb-0">
                    <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                        <h3 class = "text-dark">Information des Mitarbeiters anpassen</h3>
                    </button>
                </h1>
            </div>

            <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordionExample">
                <div class="card-body">
                    <form class="form-horizontal was-validated" id="multiCollapseExample1" th:object="${user}" th:action="@{/overrideUser}" method="post">
                        <!-- Input and View Field for the Contact Details-->
                        <input type="hidden" th:field="*{userId}"/>
                        <div class="alert alert-danger" role="alert" th:if="${#fields.hasErrors('*')}">
                            <a th:each="err : ${#fields.errors('*')}">Eine ihrer Eingaben ist falsch, bitte überprüfen Sie diese</a>
                        </div>
                        <div class="row">
                            <div class = "col">
                                <div class = "row">
                                    <div class = "col w-25">
                                        Vorname: <input type="text" class="form-control" name = "firstname"  th:field="*{firstName}" required/></br>
                                        <div class="invalid-feedback">Please fill in a Name</div>
                                    </div>
                                </div>
                                alte/neue Passwort:<input type="password" id="password" class="form-control" name ="password" pattern="(?=.*[0-9])(?=.*[a-z]).{4,}" th:field="*{password}" required/>
                                <div class="invalid-feedback">Bitte geben sie das aktuelle oder neue Passwort an.</div>
                                Passwort bestätigen:<input type="password" id="confirmPassword" class="form-control" name ="confirmNewPassword" required/>
                                <div class="invalid-feedback">Bitte bestätigen sie ihre Eingabe</div>
                            </div>
                            <div class = "col">
                                Nachname:<input type="text" class="form-control" name ="lastname"  th:field="*{lastName}" required/></br>
                                <div class="invalid-feedback">Please fill in a Name</div>
                                Username:<input type="text" id="username" class="form-control" name="username" th:field="*{username}" required></br>
                                <div class="invalid-feedback">Please fill in a unique Username</div>
                                Rolle: <input type="hidden" class="form-control" name ="lastname"  th:field="*{isAdmin}"/>
                                </br> <span th:if="${user.isAdmin == true}">Administrator</span>
                                <span th:unless="${user.isAdmin == true}">Mitarbeiter</span></br>
                            </div>
                        </div>
                        <!-- Button trigger modal -->
                        <button type="button" class="btn btn-primary mt-3" data-toggle="modal" data-target="#saveModal">
                            Änderungen speichern
                        </button>

                        <!-- Modal -->
                        <div class="modal fade" id="saveModal" tabindex="-1" role="dialog" aria-labelledby="saveModalLabel" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="saveModalLabel">Daten übernehmen</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        Sind sie sicher das Sie die Änderungen speichern möchten?
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Abbrechen</button>
                                        <button type="submit" class="btn btn-primary">Änderungen speichern</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    var password = document.getElementById("password")
        , confirmPassword = document.getElementById("confirmPassword");

    function validatePassword(){
        if(password.value != confirmPassword.value) {
            confirmPassword.setCustomValidity("Passwords Don't Match");
        } else {
            confirmPassword.setCustomValidity(''); //no special messages if the passwords match
        }
    }

    password.onchange = validatePassword;
    confirmPassword.onkeyup = validatePassword;



    //Variables needed for the password requirements; Code used based on https://www.w3schools.com/howto/howto_js_password_validation.asp
    var firstInput = document.getElementById("password");
    var confirmInput = document.getElementById("confirmPassword");
    var letter = document.getElementById("letter");
    var number = document.getElementById("number");
    var length = document.getElementById("length");

    firstInput.onkeyup = function() {
        // Validation the lowercase letters
        var lowerCaseLetters = /[a-z]/g;
        if(firstInput.value.match(lowerCaseLetters)) {
            letter.classList.remove("invalid");//if the requirement was matched the invalid notification will be swapped with a valid one
            letter.classList.add("valid");
        } else {
            letter.classList.remove("valid");
            letter.classList.add("invalid");
        }

        // Validation of used numbers
        var numbers = /[0-9]/g;
        if(firstInput.value.match(numbers)) {
            number.classList.remove("invalid");//if the requirement was matched the invalid notification will be swapped with a valid one
            number.classList.add("valid");
        } else {
            number.classList.remove("valid");
            number.classList.add("invalid");
        }

        // Validation of the password length
        if(firstInput.value.length >= 4) { //has to be 4 letters or more
            length.classList.remove("invalid");//if the requirement was matched the invalid notification will be swapped with a valid one
            length.classList.add("valid");
        } else {
            length.classList.remove("valid");
            length.classList.add("invalid");
        }
    }
</script>



<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
</body>
</html>