<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html" xmlns:sec="">
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link th:href="@{/css/style.css}" rel="stylesheet" />

    <title>Registrierung</title>
</head>

<body>

<!--Navbar fragment on top of the site. Contains all navigation elements of the project as well as the dropdown menu in order to view the options, logout or add User button-->

<header th:insert="fragments/htmlHead.html :: header"> </header>

<!-- Main Body of the user registration. It will only be available for the admins of this application. It features a small table, listing up all current users of this program
     as well as a button to open up a modal which allows te admin to create more users for this application-->
<div class = "container-fluid ml-1000 mr-1000">

    <h3 align="center" style="margin-top: 15px;margin-bottom: 15px">Mitarbeiter/User der Anwendung</h3>
    <form action = "#" th:action = "@{/registerUser}" th:object ="${user}" class="was-validated" method = post>
        <div class="form-group ml-5 mt-2 mr-5">
            <!--Button to open up the modal to create a new user-->
            <button name="submit" type="button" class="btn btn-primary mt-3" data-toggle="modal" data-target="#submitModal">
                Neuen User hinzufügen
            </button>
            <div class="modal fade" id="submitModal" tabindex="-1" role="dialog" aria-labelledby="submitModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="submitModalLabel">User Registrierung</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <!--Inputs for a user in a small Modal once the button: Neuen User hinzufügen is pushed-->
                        <div class="modal-body">
                            <div class = "row">
                                <div class = "col w-25">
                                    First Name: <input type="text" class="form-control" name = "firstName" th:field="*{firstName}">
                                </div>
                                <div class = "col w-25">
                                    Last name:<input type="text" class="form-control" name = "lastName" th:field="*{lastName}">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col w-25">
                                    Username:<input type="text" class="form-control" name = "username" th:field="*{username}" required>
                                    <div class="valid-feedback">valid.</div>
                                    <div class="invalid-feedback">Please fill in an username.</div>

                                </div>
                            </div>
                            <!--Unlike the first and last name of the user, the username has to be mentioned. If not the user wont be created after submitting. A small message under the
                            form will notify the admin if a he needs to make an input or not-->
                            <div class="row">
                                <div class="col w-25">
                                    Password:<input type="password" id="password" class="form-control" name = "password" th:field="*{password}" required>
                                    <div class="invalid-feedback">Please fill in a password.</div>
                                </div>
                                <!--The confirmation of the password. It has to be the exact same String or else the submitting progress will fail. A small speechbubble will show up
                                informing the admin that the input does not overlign with the password he typed in earlier-->
                                <div class="col w-25">
                                    Confirm Password: <input type="password" id="confirm_Password" class="form-control" name="ConfirmPassword" required>
                                    <div class="invalid-feedback">Please confirm your password.</div>
                                </div>
                            </div>
                            <!--This checkbox input gives the admin the choice of selecting a adminrole for the user.
                            Only the admin has access to the user creation and specific option of this application while a normal user can only work on contacts, events and institutions-->
                            <div>
                                <label for="adminCheckBox" th:text="'User ist ein Admin:'"></label>
                                <input type="checkbox" id="adminCheckBox" th:field="*{isAdmin}" />
                            </div>
                            <!--Small button to submit the creation of the new user as well as a dismiss button "Abbrechen" if the admin changes its mind and doesnt want to create a new user-->
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Abbrechen</button>
                                <button type="submit" class="btn btn-primary">User speichern</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
    <!--A table to view all the created user and their account information. This information consists of their full name, username, password and role. Whenever a new User is created
    the table will automatically update itself. Adding the new user to the table. It also provides an option of deleting existing users by the admin-->
    <div class = "col w-60">
        <table class="table table-striped">
            <thead>
            <th>UserId</th>
            <th>Name</th>
            <th>Username</th>
            <th>Password</th>
            <th>Rolle</th>
            <th>Funktionen</th>
            </thead>
            <!--table filled with information of the users by referencing the java class User. allUsers explained in the registrationController-->
            <tbody style="max-width: available ;overflow-x: scroll">
            <tr th:each="users : ${allUsers}">
                <td th:text="${users.userId}"></td>
                <td th:text="${users.firstName} + ' ' + ${users.lastName}"></td>
                <td th:text="${users.username}"></td>
                <td th:text="${users.password}"></td>
                <td>
                    <span th:if="${users.isAdmin == true}">Administrator</span>
                    <span th:unless="${users.isAdmin == true}">Mitarbeiter</span>
                </td>
                <td>
                    <form ACTION="#" th:action="@{/deleteUser}" th:object="${user}" method="post">
                        <input type="hidden" th:value="${users.userId}" th:name ="userId"/>

                        <button type="submit" class="btn btn-danger ml-3">User löschen</button>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    /**
     * Password confirmation function for the user creation
     *
     * Checks if the password in the second field is the exact string of the password in the first field. If not a message will pop up asking the user to
     * change the second input until the strings are the same.
     *
     * @type {HTMLElement}
     * @param var password
     */
    var password = document.getElementById("password")
        , confirm_Password = document.getElementById("confirm_Password");

    function validatePassword(){
        if(password.value != confirm_Password.value) {
            confirm_Password.setCustomValidity("Passwords Don't Match");
        } else {
            confirm_Password.setCustomValidity(''); //no special messages if the passwords match
        }
    }

    password.onchange = validatePassword;
    confirm_Password.onkeyup = validatePassword;
</script>



<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
</body>
</html>